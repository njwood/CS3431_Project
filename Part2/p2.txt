drop view NoCurator;

create view NoCurator as
    select L.locationID, S.accountName
    from Location L
    join Staff S
        on L.locationID  = S.locationID
    join StaffPosition SP
        on SP.accountName = S.accountName
    where (L.locationType = 'Office') and (SP.positionID not like '%CURATOR%');
    
--select * from NoCurator;

select locationID, count(accountName) as CNT
    from NoCurator
group by locationID;

create or replace trigger NoSameStartEnd
after insert on Edge
for each row
begin 
    if(:new.startingID = :new.endingID) then
        RAISE_APPLICATION_ERROR(-20004, 'Edge: startingID and endingID cannot be the same');
    end if;
end;
/

create or replace trigger OnlyStaircases
after insert on Edge
for each row
begin
    if(SUBSTR(:new.startingID, 1, 1) = SUBSTR(:new.endingID, 1, 1)) then
        if(SUBSTR(:new.startingID, 2, 2) = SUBSTR(:new.endingID, 2, 2)) then
            RAISE_APPLICATION_ERROR(-20005, 'Edge: staircases must be different');
        end if;
    end if;
end;
/